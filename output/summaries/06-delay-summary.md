# 6장: 지연(Delay) - 요약

## 📌 핵심 개념

- **응답 시간 = 이벤트 카운트 × 이벤트 시간**
- **대기 지연(Queueing Delay)**: 리소스 사용률이 높을 때 발생하는 대기열 효과
- **서비스 시간(S)**: 자체 처리 시간
- **대기 지연(Q)**: 줄 서서 기다리는 시간
- **응답 시간(R) = Q + S**: 대기와 처리의 합
- **트래픽 강도(ρ)**: 시스템이 얼마나 바쁜지 (0~1)
- **일관성 지연(Coherency Delay)**: 분산 시스템에서 캐시 일관성·동기화로 인한 추가 시간

## 🎓 주요 교훈 (사례 기반)

**케빈의 청구서 생성**
- 월초: 41초, 80,000+ 블록 읽기 @ 0.000464초/회
- 월말: 300초 이상, 블록 읽기 시간 10배 증가
- 원인: 암달의 법칙 (병목인 블록 읽기가 10배 느려지면 전체도 10배 이상)
- 해결: 카운트 감소 (82,000→3,000) → 1초대로 단축 가능

**대기열 효과**
- p(사용률) ≈ 0.88일 때: Q ≈ 3.5S → R ≈ 4.5S
- 그래프: p→1에 가까워지면 R이 급격히 증가 (하키 스틱 모양)
- 사용률을 낮추거나 서비스 채널을 늘려야 R을 안정화

**일관성 지연의 이중 악화**
- 분산 시스템에서 동기화 비용 증가 → S 자체 증가 → ρ도 증가 → Q까지 커짐
- 캐시 일관성/동기화 비용을 줄이면 특히 부하 높을 때 효과 큼

## 💡 실행 가능한 가이드

### 지연 감소 전략

1. **카운트 줄이기 먼저**
   - 불필요 쿼리/IO/루프/데이터 반환 제거

2. **시간 줄이기**
   - 인덱스, 캐시, 네트워크/스토리지 튜닝, 하드웨어 증설

3. **기준선 확보**
   - 정상 시 프로파일 저장 (월초 vs 월말 비교)

4. **대기열 감시**
   - 스토리지/네트워크 사용률, 대기열 길이 모니터링
   - 사용률(ρ)이 급등하지 않도록 관리

5. **암달 체크**
   - 응답 시간의 큰 비중을 차지하는 이벤트 확인
   - 그것부터 개선

### 설계 원칙

- **병렬 채널 비용 고려**: 노드 수 증가 시 N² 관계 주의
- **처리량과 지연의 트레이드오프**: 동기화 비용 vs 성능 균형

## 📋 체크리스트

- [ ] 케빈 사례처럼 월초/월말 프로파일을 비교했는가?
- [ ] 카운트 감소로 먼저 개선했는가?
- [ ] 블록 읽기·네트워크 요청·DB 호출 같은 주요 이벤트 카운트를 확인했는가?
- [ ] 서비스 시간(S)과 대기 지연(Q)을 구분했는가?
- [ ] 시스템 사용률(ρ)이 높아지면서 대기 지연이 급증하는지 모니터링했는가?
- [ ] 분산 시스템의 일관성 지연을 고려했는가?
- [ ] 암달의 법칙으로 개선 효과를 예측했는가?

## 🎯 한 문장 요약

> **지연은 카운트와 시간뿐 아니라 대기열과 일관성 비용까지 고려해야 하며, 사용률이 높을수록 기하급수적으로 증가한다.**

---

[← 이전: 5장 - 실전 사례](05-real-world-examples-summary.md) | [다음: 7장 - 낭비 →](07-waste-summary.md)

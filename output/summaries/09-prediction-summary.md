# 9장: 예측(Prediction) - 요약

## 📌 핵심 개념

- **프로파일 기반 의사결정**: "만약 ~한다면?"을 산수로 가늠
- **선형 모델**: 총시간(B) = 카운트(C) × 평균 시간(D)
- **선형 개선 방법 2가지**: (1) 카운트 줄이기 (2) 평균 시간 줄이기
- **분포의 중요성**: 평균 뒤에 숨은 왜곡(skew) 주의
- **비선형 효과**: 대기열·상호의존성으로 인해 선형 예측이 빗나갈 수 있음
- **1차 예측 후 보정**: 선형 예측 후 대기열·왜곡·의존성 검토

## 🎓 주요 교훈 (사례 기반)

**TPS 예측 사례**
- 프로파일: 디스크 읽기 0.1%, 나머지 99.9%는 비-디스크
- 결론: 초고속 스토리지 구매로 0.1% 이상 개선 불가능
- **의미 없는 투입을 예측으로 미리 막을 수 있음**

**왜곡(skew)의 함정**
- 예: 단일 블록 읽기 1,001만 회, 평균 0.006초
- 절반 제거 시 절약 시간은 **어떤 호출을 제거하느냐**에 따라 다름
- 느린 버킷 (버킷 7, 8) 적은 호출을 없애면 수 시간 단축 가능
- 빠른 버킷 (버킷 3) 많은 호출을 없애도 시간 절감 미미
- **평균 뒤의 분포를 먼저 본다**

**상호의존성 예시**
- 한 이벤트를 줄이면 다른 이벤트도 함께 줄어들거나 새 이벤트가 나타날 수 있음
- 최적 조회 크기 튜닝 시, 네트워크 I/O가 새로 병목이 되는 지점 존재

**비선형 효과**
- 호출 수 25% 감소 → 대기열 효과로 호출당 시간까지 줄어들어 **선형 예측 초과 개선**
- M/M/2 모델: p = 0.9 → 0.6 (10% 감소)로 대기 지연 Q가 4.26S → 0.56S (7배 이상 개선)

## 💡 실행 가능한 가이드

### 1차 선형 예측

1. **프로파일에서 각 행의 구성 확인**
   - B(총시간) = C(카운트) × D(평균시간)

2. **개선 가정 입력**
   - C를 10% 줄인다면? (중복 호출 제거)
   - D를 50% 줄인다면? (인덱스 추가)

3. **스프레드시트로 계산**
   - 변경 후 총시간 재계산
   - 개선 효과 정량화

### 왜곡 고려

1. **분포 버킷 확인**
   - 최소/최대 실행시간
   - 느린 호출 vs 빠른 호출의 비중

2. **버킷별 제거 효과 시뮬레이션**
   - 느린 버킷 호출 몇 개 제거 vs 빠른 버킷 많이 제거

3. **가장 효과적인 선택지 결정**
   - 적은 변경으로 큰 개선을 가져올 부분 선택

### 비선형 보정

1. **대기열 효과 검토**
   - 호출 감소 → 사용률 하락 → 대기 지연 추가 감소?

2. **상호의존성 확인**
   - 한 이벤트 개선이 다른 이벤트에 미치는 영향

3. **최종 예측 보정**
   - 선형 예측 ± 비선형 효과

## 📋 체크리스트

- [ ] 프로파일로 1차 선형 예측을 했는가?
- [ ] 평균만 본 게 아니라 분포(버킷)를 확인했는가?
- [ ] 느린 호출 vs 빠른 호출의 비중을 파악했는가?
- [ ] 가장 효과적인 제거 대상을 선택했는가?
- [ ] 상호의존성·대기열 효과를 고려한 보정을 했는가?
- [ ] 스프레드시트로 "만약 ~한다면"을 계산했는가?

## 🎯 한 문장 요약

> **프로파일 기반 예측은 선형 계산으로 1차 추정 후 분포와 비선형 효과로 보정해야 정확하다.**

---

[← 이전: 8장 - 문제 해결](08-problem-solving-summary.md) | [다음: 10장 - 지연 숨기기 →](10-latency-hiding-summary.md)

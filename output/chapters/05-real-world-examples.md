# 5장: 실전 사례

---

## 00. 들어가며

현장에서 성능 문제를 다루면 늘 **사람·정책·기술**이 얽혀 있다. 이 장은 단순한 모니터링 그래프가 아니라 **현장에서 관찰한 증상과 그 해결 과정**을 통해 배운 교훈을 정리한다.

- 관찰: 증상이 발생한 자리(사용자·장비)에서 본다.
- 우선순위: 비즈니스 영향이 가장 큰 것부터.
- 데이터: 프로파일·추적·숫자로 설명한다.
- 검증: 조치 후 결과를 측정한다.

---

## 01. 컨설턴트 데브라: 청구서 전체 출력 사건

### 상황
- 시스템: 청구서 목록을 매일 출력하는 배치
- 증상: 출력 속도는 느리지 않지만 **종이 수천 장 낭비**, 창고·프린터·네트워크까지 리소스 과다 사용
- 단서: “매일 박스 단위 종이가 휴지통으로 간다”

### 관찰과 원인
- 현장 방문 후 UI에서 **`[마지막 실행 날짜 기억하기]` 체크박스가 해제**된 것을 발견.
- 체크박스가 꺼져 있어 “지금까지 생성된 모든 청구서”를 매일 다시 출력.
- 시스템 도입 직후엔 문제를 체감하기 어렵지만, 시간이 지날수록 출력량이 **제곱으로 증가**하는 램프(ramp) 안티패턴.

### 램프 문제: 제곱으로 불어나는 낭비
- 하루에 새로 생기는 청구서 목록: 16장(예시)
- n일째 출력 분량: `16 * n(n+1)/2` 장 → 낭비분은 `16 * (n^2 - 1)/2`
- 130근무일(약 6개월) 후: 136,240장(273묶음) 출력, 그중 2,080장만 유효 → **거의 전량 낭비**
- 1년(260근무일) 후라면 542,880장(1,086묶음)까지 폭증
- 종이만 낭비되는 게 아니다: CPU·메모리·디스크·네트워크·사람 시간 모두 불필요하게 소비되어 전체 시스템 부하를 끌어올림.

### 조치와 결과
- **체크박스 ON**: “지난 실행 이후 생성분만 출력”으로 즉시 전환.
- 낭비가 하루 16장 수준으로 떨어지고, 시스템 부하·사용자 불만도 사라짐.

### 교훈
- 증상이 보이는 자리로 가서 **UI·업무 흐름을 직접 본다**.
- 점진적 악화 패턴(램프)은 초기에 체감이 약해 **놓치기 쉽다**. 숫자로 성장률을 계산해 위협을 보여줘야 한다.
- 필터링은 “결과 후처리”가 아니라 **실행 전에** 적용하는 게 가장 효과적이다.

---

## 02. 수정할까, 자원을 더할까? (SSD vs 알고리즘)

### 상황
- 청구서 생성이 느려 월말에 병목. 제안: SSD 어레이 구매 vs 코드 수정.

### 분석
- 프로파일을 보면 **데이터 접근 알고리즘**을 개선하면 SSD 없이도 200초 → 5초로 가능.
- SSD로 1초 미만까지 줄이는 건 “추가 옵션”일 뿐, **첫 단계는 비효율 제거**.
- 결정은 기술보다 **신뢰의 문제**이기도 하다: 과거에 “수정”으로 성공 경험이 없다면 조직은 장비 구매에 더 기운다.

### 기준
- 우선순위 높은 프로그램의 **프로파일**을 확보한다.
- **이벤트 카운트 감소**(수정) vs **이벤트 시간 감소**(하드웨어) 중 ROI가 큰 쪽부터.
- 필요하면 두 방법을 조합하되, **증상 중심**으로 판단한다.

---

## 03. 예티: 하드웨어 업그레이드가 느리게 만든 사례

### 상황
- 급여 배치(PYUGEN) 성능 문제로 CPU를 700MHz → 1GHz로 업그레이드.
- 기대: 더 빠른 CPU → 프로그램 단축.
- 결과: **더 느려짐**. “업그레이드하면 느려진다”는 믿기 힘든 예티 같은 현상.

### 프로파일(요약)
- 총 1,957초 중 **네트워크 I/O 대기 50%**(SQL*Net 메시지), 디스크 I/O 14%, CPU 7% 등.
- CPU 업그레이드로 절약 가능한 시간은 약 115초뿐.

### 원인
- 애초에 CPU 사용 비중이 낮아 업그레이드 효과가 제한적.
- CPU가 빨라지며 네트워크 호출 빈도가 높아져 **트래픽 강도 상승 → 네트워크 대기 증가**.
- 잘못된 설정으로 이미 서비스 시간이 늘어난 상태에서 네트워크 대기가 더 커짐.
- 암달의 법칙: 비CPU 구간이 크면 CPU 업그레이드로는 한계가 있다.

### 교훈
- **프로파일 없이 업그레이드 금지**: 우선순위 높은 프로그램의 시간 분해가 먼저.
- “예티”는 실제로 존재한다: 하드웨어가 성능을 **악화**시킬 수도 있다.
- 업그레이드 전 “얼마나 단축 가능한가?”를 계산하고, 병목이 네트워크·스토리지라면 그 지점을 먼저 해결한다.

---

## 04. 빠른 속도 vs 효율성

### 다른 개념이다
- **빠른 속도**: 실제 응답 시간이 짧다.
- **효율성**: 필요한 일만 하고, 리소스를 덜 쓴다.
- 비효율적인 프로그램도 하드웨어를 갈아끼우면 빠를 수 있고, 효율적인 프로그램도 느릴 수 있다(병목이 다른 곳이면).

### 실무 기준
- 프로파일에서 **이벤트 카운트**(얼마나 많이)와 **이벤트 시간**(얼마나 오래) 둘 다 본다.
- “빠르다”만 추구하면 **부수적 피해**(다른 작업 느려짐, 비용 폭증)가 생길 수 있다.
- 우선순위가 높은 프로그램의 **효율**을 먼저 높이고, 필요한 경우에만 속도를 더 끌어올린다.

---

## 05. 다시 보는 관찰/측정/검증 포인트

### 관찰
- **현장**: 프린터, 터미널, 체크박스, 네트워크 경로를 눈으로 확인.
- **시간 성장 패턴**: 선형인지 제곱(ramp)인지 확인.

### 측정
- **프로파일/추적**: 이벤트 카운트 vs 이벤트 시간.
- **기준선**: 정상 동작 시 프로파일을 하나 확보해 둔다(비교용).
- **성장 계산**: `n(n+1)/2`처럼 누적이 폭증하는지 수식으로 설명.

### 조치와 검증
- **한 번에 하나**: 변경 → 측정 → 개선율 기록.
- **부수적 피해 점검**: 특정 프로그램을 개선하면서 다른 곳이 느려지지 않았는지 확인.
- **ROI 관점**: 수정(카운트 감소) vs 자원 추가(시간 단축)를 숫자로 비교.

---

## 체크리스트

```
□ 증상 위치를 직접 본다 (사용자 자리, 프린터, 네트워크 경로)
□ 성장 패턴을 확인한다 (선형 vs 제곱 램프)
□ 프로파일/추적을 확보한다 (이벤트 카운트·시간 분해)
□ 우선순위가 높은 프로그램부터 본다
□ 수정으로 줄일 수 있는 비효율을 찾는다 (카운트 감소)
□ 필요 시 자원 추가를 검토한다 (시간 단축), 근거는 숫자로
□ 변경 후 다시 측정하고 개선율을 기록한다
□ 부수적 피해가 없는지 점검한다 (다른 프로그램·리소스 영향)
```

---

[← 이전: 4장](04-optimization-techniques.md) | [다음: 6장 →](06-performance-culture.md)

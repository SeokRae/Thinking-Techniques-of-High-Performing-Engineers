# 4장: 성능 분석(카운트 vs 시간)

---

## 00. 들어가며

응답 시간을 줄이는 방법은 딱 두 가지다:

1) **이벤트 카운트를 줄이기** (얼마나 많이 실행되는가)  
2) **이벤트 시간을 줄이기** (각 실행이 얼마나 오래 걸리는가)

이 장은 프로파일을 바탕으로 **카운트 vs 시간** 두 축에서 최적화하는 방법과 현장 사례를 다룬다.

---

## 01. 이벤트 카운트 줄이기

### 방울토마토·초콜릿 비유
- 장바구니에서 초콜릿(불필요 이벤트)을 빼면 전체 비용이 즉시 감소.
- 프로파일에서도 불필요 이벤트를 제거하면 응답 시간이 바로 줄어든다.

### 어디서 줄일까?
- 설정/기능 끄기: 불필요한 로그, 통계, 반복 쿼리
- 중복 작업 제거: 같은 데이터 반복 조회, 불필요 루프
- 반환 데이터 줄이기: 필요한 행/컬럼만, pagination, 필터

### 기준선 잡기
- **정상일 때** 프로파일을 하나 확보해둔다. 문제가 생겼을 때 비교해 낭비 카운트를 찾기 쉽다.

---

## 02. 토우-밀샙 법칙: “열 줄 이상은 요약으로”

사람은 보통 **열 줄 넘는 데이터**를 그대로 보고 싶어하지 않는다.  
→ 집계(카운트/합계/평균/그래프)로 보여주면 더 빠르고 효율적이다.

- 사용자에게 정말 많은 데이터를 보여줘야 하는지 확인.  
- 불필요한 데이터 리턴을 줄이면 CPU·네트워크·디스크 모두 절약.

---

## 03. 병목의 정의와 보기

**병목**: 응답 시간에서 가장 많은 비율을 차지하는 리소스/이벤트.

### 예시 (급여 배치 프로파일)
- SQL*Net 메시지: 50% (네트워크 대기)
- SQL*Net 추가 데이터: 21%
- 디스크 순차 읽기: 14%
- CPU(파싱/실행): 소수

→ 이 경우 병목은 CPU가 아니라 **네트워크/IO 대기**. CPU 업그레이드만으로는 개선이 제한적.

### 카운트 vs 시간
- 카운트 감소: 이벤트 호출 수를 줄인다(락 제거, 중복 쿼리 제거 등).
- 시간 감소: 각 이벤트를 더 빠르게(인덱스, 캐시, 네트워크 튜닝, 하드웨어).

---

## 04. 주요 실행 경로(critical path)

- 어떤 태스크의 **연속된 필수 작업**이 전체 시간을 결정한다.
- 간트 차트로 병렬/독립 작업을 구분하고, **주요 경로**에 있는 작업부터 단축한다.
- 병렬 작업이라도 리소스를 경쟁하면 영향을 주고받을 수 있으므로, 실제 프로파일을 본다.

---

## 05. 케빈의 청구서 사례

### 상황
- 청구서 출력이 정상 시 40초 → 월말엔 300초 이상으로 악화.
- SSD 환경에서도 **블록 읽기** 카운트가 과도(수만~수십만 회).

### 접근
1. 월초에 정상 상태 프로파일을 확보(기준선).
2. 월말 느려진 상태와 비교해 **불필요 블록 읽기 카운트**가 폭증한 것을 확인.
3. 알고리즘/쿼리/필터를 수정해 **카운트 자체를 줄임**.

### 교훈
- 빠른 IO라도 **너무 많이** 하면 느려진다.
- 기준선을 잡아두면 증상 재현 없이도 원인 구간을 찾기 쉽다.

---

## 06. 최적화의 두 축 정리

| 축 | 방법 | 예시 |
|----|------|------|
| 카운트 감소 | 중복 제거, 불필요 호출 끄기, 반환량 줄이기 | 테이블 락 제거, 불필요 정렬/조인 제거 |
| 시간 감소 | 더 빠르게 실행되게 만들기 | 인덱스, 캐시, 네트워크/스토리지 튜닝, 더 빠른 HW |

둘 다 중요한데, **카운트 감소 → 시간 감소** 순으로 보면 ROI가 높은 경우가 많다.

---

## 체크리스트

```
□ 프로파일로 병목(비율 최대)을 확인했는가?
□ 카운트 vs 시간 중 어디를 먼저 줄일지 결정했는가?
□ 불필요 이벤트/데이터를 제거했는가? (토우-밀샙 법칙)
□ 주요 실행 경로를 파악했는가? (간트 차트/병렬성 고려)
□ 기준선 프로파일을 확보했는가? (정상 vs 문제 상태 비교)
□ 변경 후 다시 프로파일링해 개선을 확인했는가?
```

---

[← 이전: 3장](03-performance-measurement.md) | [다음: 5장 →](05-optimization-cases.md)

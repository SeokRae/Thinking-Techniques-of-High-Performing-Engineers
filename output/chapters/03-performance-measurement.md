# 3장: 성능 측정(프로파일링)

---

## 00. 들어가며

측정 없이 개선 없다. 이 장은 **추적 → 프로파일링 → 의사결정**의 흐름을 다룬다.

- 증상은 **현장**에서 보고
- **추적**으로 데이터를 모으고
- **프로파일**로 정리해서
- **우선순위** 높은 원인을 먼저 처리한다

---

## 01. 프로파일 예시: A/B/C 이벤트

### 추적 데이터(요약)
- 이벤트 C: 0.088초
- 이벤트 B: 0.096초
- 이벤트 A: 0.075초

### 프로파일 만들기
- 이벤트별 총시간, 실행 횟수, 평균시간을 집계한다.
- 스프레드시트/프로파일러는 다음을 해줘야 한다:
  - **이벤트 이름별 그룹화**
  - **총 실행 시간 합계**
  - **총 실행 횟수 집계**
  - **평균 실행 시간(총시간/횟수) 계산**

### 프로파일러가 풀어야 할 과제
- **중첩 이벤트**: 부모-자식 관계를 구분해 이중 계산을 막는다.
- **커버리지**: 추적이 코드 경로 전부를 대표하지 못함을 설명할 수 있어야 한다.
- **성능**: 수백만 이벤트를 빠르게 집계할 수 있어야 한다.

결론: 성능을 알려주는 최선의 도구는 **프로파일링**이다.

---

## 02. 추적-프로파일 절차 (Method R 관점)

1. **증상 S 관찰**: 가능하면 문제 발생 순간에 본다.
2. **프로그램 P 추적**: 증상이 나타나는 실행을 캡처.
3. **실행 시간이 목표의 3배**를 넘으면 추적 중단(불필요한 데이터 폭증 방지).
4. **추적 데이터로 프로파일 생성**: 이벤트 카운트/시간을 정리.
5. **원인 C 식별**: 데이터에 근거해 병목을 찾는다.
6. **조치로 증상 해결**: 수정 또는 자원 추가.
7. **검증**: 다시 측정해 개선을 확인.

### 얼마나 추적할까?
- 부족한 추적: 원인을 설명할 데이터가 없음.
- 과도한 추적: 분석·집계가 방해받을 정도로 노이즈가 많음.
- 해결책:
  - 추적 대상을 **해당 기능**으로 제한하거나,
  - 프로파일 집계에서 **불필요 구간을 잘라** 분석.
  - 병렬 실행 시 **간트 차트** 등으로 중요 경로를 식별.

### 측정 침입(오버헤드)
- 추적은 가벼울수록 좋다(±5% 이내가 보통 허용 범위).
- 하지만 한 번의 추적으로 큰 개선(예: 1시간→30분)이 가능하다면 **투자 가치**가 있다.
- 좋은 추적 기능의 특징:
  - **세션 타기팅**: 특정 사용자/그룹만 추적 가능
  - **관점 타기팅**: DB 호출, 시스템 호출, 캐시 조작 등 선택적 수집
  - **상세 수준 조정**: 얼마나 깊이 기록할지 결정 가능

---

## 03. 프로파일링의 목표: 병목 정의

병목은 “응답 시간 대부분을 차지하는 리소스”. 프로파일로 병목을 보면:
- 어디서 시간/자원이 소비되는지 보인다.
- 개선 방법은 두 가지뿐이다:
  1) **이벤트 카운트 감소** (불필요 호출 제거, 중복 작업 제거)
  2) **이벤트 시간 감소** (더 빠른 알고리즘/IO/네트워크/하드웨어)

---

## 04. 관측 가능성과 기능화

성능은 **기능**이다. 중요한 기능(주문, 급여, 반품 등)은 실행 시간이 기록되고 비교 가능해야 한다.

- 주요 기능의 **응답 시간 기록** 테이블을 갖춘다.
- 지역/시간대별 성능을 모니터링해 **사용자 불만 전에** 감지한다.
- 추적/프로파일 데이터를 제품 기능으로 제공하면, 문제 재현 없이도 근거 기반 조치가 가능하다.

---

## 05. 측정 팁과 함정

### 캐시 효과
- 첫 실행(캐시 미스) vs 반복 실행(캐시 히트)을 구분해 측정한다.

### 샘플링
- 프로덕션에선 가벼운 샘플링, 테스트/재현 환경에선 상세 추적.

### 데이터 품질
- 프로파일에서 이상하게 긴 시간(예: 40분→300분)이 보이면 필터링/집계 오류 가능성 검토.

---

## 체크리스트

```
□ 증상이 나타나는 실행을 추적했는가?
□ 추적을 기능/세션/관점으로 적절히 제한했는가?
□ 프로파일에서 이벤트 카운트·시간을 모두 확인했는가?
□ 병목을 카운트 vs 시간 관점 중 어디로 풀지 결정했는가?
□ 측정 오버헤드와 샘플링 전략을 설계했는가?
□ 캐시 히트/미스, 병렬 실행(간트 차트) 등 실행 패턴을 구분했는가?
□ 변경 후 다시 측정해 개선을 검증했는가?
```

---

[← 이전: 2장](02-method-r.md) | [다음: 4장 →](04-performance-analysis.md)
